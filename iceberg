#! /usr/bin/php
<?php

include __DIR__."/lib/iceberg/Autoloader.php";
include __DIR__."/lib/iceberg/ErrorHandler.php";

use iceberg\Autoloader;
use iceberg\ErrorHandler;

use iceberg\hook\Hook;
use iceberg\cmd\Command;
use iceberg\config\Config;
use iceberg\shell\ArgumentParser;

define("ICEBERG_TIMEZONE", "Europe/Berlin");
define("ICEBERG_LOG", "iceberg.log");
define("ICEBERG_CONFIG", "config.ini");

date_default_timezone_set(ICEBERG_TIMEZONE);

ErrorHandler::register(ICEBERG_LOG);

Autoloader::register();
Autoloader::addNamespace("iceberg", __DIR__."/lib/iceberg");
Autoloader::addNamespace("hooks", __DIR__."/hooks");
Autoloader::addNamespace("commands", __DIR__."/lib");

$arguments = ArgumentParser::getInstance();

if ($arguments->config_val)
	Config::loadFromFile($arguments->config_val);
else
	Config::loadFromFile(ICEBERG_CONFIG);

Hook::setNamespace("hooks\{hook}Hook");

if ($arguments->no_hook)
	Hook::setEnabled(false);
else
	Hook::setEnabled(true);
	
Command::setNamespace("commands\{command}");
Command::call($arguments->command);